<!DOCTYPE html><html>
<head>
    <meta charset="UTF-8">
    <title>Desafio Cavalo x Dama - Xadrez</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }#container {
        max-width: 800px;
        padding: 20px;
    }

    h1 {
        color: #333;
        text-align: center;
        margin-bottom: 20px;
    }

    #instructions {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    #timer {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
    }
    #time {
        font-size: 1.2em;
        margin-right: 10px;
    }

    #board {
        display: flex;
        flex-direction: column;
        width: 400px;
        height: 400px;
        border: 2px solid #333;
        margin: 0 auto;
    }

    .row {
        display: flex;
        flex: 1;
    }

    .square {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .white {
        background-color: #f0d9b5;
    }

    .black {
        background-color: #b58863;
    }

    .knight {
        color: #006400;
        text-shadow: 1px 1px 2px white;
    }

    .queen {
        color: #8B0000;
        text-shadow: 1px 1px 2px white;
    }

    .selected {
        background-color: #ffeb3b !important;
        box-shadow: inset 0 0 10px #c8b900;
    }

    .legal-move {
        box-shadow: inset 0 0 15px rgba(0, 100, 0, 0.5);
    }
</style>

</head>
<body>
    <div id="container">
        <h1>Desafio Cavalo x Dama</h1><div id="instructions">
        <h3>Resumo do Desafio</h3>
        <ul>
            <li><strong>Objetivo:</strong> Levar o cavalo de <em>a1</em> até <em>h8</em>, evitando casas atacadas pela dama em <em>d5</em>.</li>
            <li><strong>Movimento:</strong> saltos em "L" (2x1 ou 1x2).</li>
            <li><strong>Ameaças:</strong> dama ataca em linha reta (horizontal, vertical) e diagonais; evite essas casas.</li>
            <li><strong>Estratégia:</strong> avance nível por nível (linha 1, linha 2 etc.), sempre seguindo caminhos seguros.</li>
            <li><strong>Desafio extra:</strong> termine em menos de 10 minutos para um desempenho excelente.</li>
        </ul>
    </div>

    <div id="timer">
        <span id="time">00:00</span>
        <button id="toggleTimer">Start</button>
    </div>

    <div id="board"></div>
</div>

<script>
    // Timer
    let timerInterval = null;
    let elapsedSeconds = 0;
    const timeDisplay = document.getElementById('time');
    const toggleBtn = document.getElementById('toggleTimer');

    function formatTime(sec) {
        const m = String(Math.floor(sec / 60)).padStart(2, '0');
        const s = String(sec % 60).padStart(2, '0');
        return `${m}:${s}`;
    }

    function updateTimer() {
        elapsedSeconds++;
        timeDisplay.textContent = formatTime(elapsedSeconds);
    }

    toggleBtn.addEventListener('click', () => {
        if (timerInterval === null) {
            timerInterval = setInterval(updateTimer, 1000);
            toggleBtn.textContent = 'Stop';
        } else {
            clearInterval(timerInterval);
            timerInterval = null;
            toggleBtn.textContent = 'Start';
        }
    });

    // Xadrez: Cavalo vs Dama
    let currentKnightPos = 'a1';
    let isKnightSelected = false;

    function posToXY(pos) {
        const x = pos.charCodeAt(0) - 'a'.charCodeAt(0);
        const y = parseInt(pos[1]) - 1;
        return { x, y };
    }

    function xyToPos(x, y) {
        return String.fromCharCode(97 + x) + (y + 1);
    }

    function handleSquareClick(e) {
        const pos = e.target.dataset.pos;
        const square = e.target;
        if (pos === currentKnightPos) {
            isKnightSelected = !isKnightSelected;
            square.classList.toggle('selected', isKnightSelected);
            highlightLegalMoves(isKnightSelected ? pos : null);
        } else if (isKnightSelected) {
            if (validateMove(currentKnightPos, pos)) {
                moveKnight(pos);
                checkVictory();
            } else {
                alert('Movimento inválido!');
            }
            resetSelection();
        }
    }

    function validateMove(fromPos, toPos) {
        const from = posToXY(fromPos);
        const to = posToXY(toPos);
        const dx = Math.abs(to.x - from.x);
        const dy = Math.abs(to.y - from.y);
        if (!((dx === 2 && dy === 1) || (dx === 1 && dy === 2))) return false;
        const queenPos = posToXY('d5');
        return !isThreatened(to.x, to.y, queenPos.x, queenPos.y);
    }

    function isThreatened(x, y, qx, qy) {
        return x === qx || y === qy || Math.abs(x - qx) === Math.abs(y - qy);
    }

    function highlightLegalMoves(fromPos) {
        document.querySelectorAll('.legal-move').forEach(sq => sq.classList.remove('legal-move'));
        if (!fromPos) return;
        const from = posToXY(fromPos);
        const moves = [
            {dx: 2, dy: 1}, {dx: 2, dy: -1},
            {dx: -2, dy: 1}, {dx: -2, dy: -1},
            {dx: 1, dy: 2}, {dx: 1, dy: -2},
            {dx: -1, dy: 2}, {dx: -1, dy: -2}
        ];
        moves.forEach(({dx, dy}) => {
            const x = from.x + dx;
            const y = from.y + dy;
            if (x >= 0 && x < 8 && y >= 0 && y < 8) {
                const pos = xyToPos(x, y);
                const square = document.querySelector(`[data-pos="${pos}"]`);
                if (validateMove(fromPos, pos)) square.classList.add('legal-move');
            }
        });
    }

    function resetSelection() {
        isKnightSelected = false;
        document.querySelectorAll('.selected, .legal-move').forEach(sq => sq.classList.remove('selected', 'legal-move'));
    }

    function moveKnight(toPos) {
        const oldSquare = document.querySelector(`[data-pos="${currentKnightPos}"]`);
        oldSquare.textContent = '';
        oldSquare.classList.remove('knight');
        const newSquare = document.querySelector(`[data-pos="${toPos}"]`);
        newSquare.textContent = '♘';
        newSquare.classList.add('knight');
        currentKnightPos = toPos;
    }

    function checkVictory() {
        if (currentKnightPos === 'h8') {
            alert('Parabéns! Você completou o desafio!');
            resetSelection();
        }
    }

    const board = document.getElementById('board');
    for (let row = 8; row >= 1; row--) {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'row';
        for (let col = 0; col < 8; col++) {
            const x = col;
            const y = row - 1;
            const pos = xyToPos(x, y);
            const square = document.createElement('div');
            square.className = `square ${(x + y) % 2 === 0 ? 'white' : 'black'}`;
            square.dataset.pos = pos;
            if (pos === 'a1') {
                square.textContent = '♘';
                square.classList.add('knight');
            } else if (pos === 'd5') {
                square.textContent = '♛';
                square.classList.add('queen');
            }
            square.addEventListener('click', handleSquareClick);
            rowDiv.appendChild(square);
        }
        board.appendChild(rowDiv);
    }
</script>

</body>
</html>